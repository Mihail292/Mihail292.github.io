
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>151019</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				margin: 0px;
				
				overflow: scroll;
				
			};
			

		</style>
	</head>
	<body>
	
 </body>
</html>

<div id="div0" style="position:fixed;top:0px;left:0px;width:110px;height: 150px;"></div>
<div id="div5" style="position:fixed;top:0px;left:110px;width:110px;height: 150px;"></div>
<div id="div1" style="position:fixed;overflow: auto;top:0px;left:220px;width:70%;height: 100px;"></div>
<div id="div2" style="position:fixed;overflow: auto;top:100px;left:220px;width:70%;height: 100px;"></div>
<div id="div3" style="position:fixed;overflow: auto;top:200px;left:220px;width:70%;height: 100px;"></div>
<div id="div4" style="position:fixed;overflow: auto;top:300px;left:220px;width:70%;height: 100px;"></div>




	
<div id ="pl0" style="position:fixed;display:block;overflow: scroll;background: #00ff00;width:220px;height: 250px; top:150px;left:0%"><div id='d'></div></div>

<script>
var canvas = document.createElement("CANVAS");var wh=5;var rX=340;var rY=525;var ofX=ofY=0;
canvas.width=1028/wh;canvas.height=1586/wh;var ctxk = canvas.getContext('2d');var nuznMast;
window.addEventListener( 'keydown', KeyboardDOWN, false );
var kartyIgrokov=[];var kon;var nk=0;var cards=[];var coloda=[];var sovpadNaRukah=[];var img=[];var loadImg=0;
var K={};snbd=[];snb=[];
var kolichestvoIgrokov=2,po_skolko_kart=11;index_karty=0;hodit_igrok=0;ochkiigrokow=[];var nH=false;
for (var i=1; i<7; i++){img[i] = document.createElement("IMG");img[i].src = `./карты/${i}.jpg`;};
for (var i=1; i<7; i++){img[i].onload=function(){loadImg++;if(loadImg==6){rk(kon,0);rubashka();
risuem_karty_igrokov()};}};
for (var i=0; i<kolichestvoIgrokov;i++){ochkiigrokow.push(0)};
function rnd(a,b) {return a+Math.floor(Math.random()*(b-a+1))};
function KeyboardDOWN(){if (event.key=='1'){obr_hod(0);};
if (event.key=='2'){obr_hod(1);};
if (event.key=='3'){obr_hod(2);};
if (event.key=='4'){obr_hod(3);};
if (event.keyCode==81){if (nH==false){hod()}else{newH()};};};
function newH(){kartyIgrokov=[];cards=[];coloda=[];sovpadNaRukah=[];
for(i=0;i<6;i++)document.getElementById(`div${i}`).innerHTML = "";
ct();peretus(cards);razd();risuem_karty_igrokov();rubashka();rk(kon,0);nH=false;
};
function podschet_ochkov(){//document.getElementById('d').innerHTML = ""; 
csl('Считаем очки','red');nH=true;
for (var i=0; i<kolichestvoIgrokov;i++){for (let ki of kartyIgrokov[i]){ochkiigrokow[i]+=ki.ochki}};
for (var i=0; i<kolichestvoIgrokov;i++){csl(kartyIgrokov[i].n + ' ' + ochkiigrokow[i]);
if (ochkiigrokow[i]==101){ochkiigrokow[i]=0;csl(kartyIgrokov[i].n + ' набрал 101 его очки обнулились')};
if (ochkiigrokow[i]>101){csl(kartyIgrokov[i].n + ' ПРОИГРАЛ GAME OVER');return};}
csl('game go on');}
function csl(text,color){
var my_div = newDiv = null;
var newDiv = document.createElement("div");
newDiv.innerHTML = text;newDiv.style.color=color;
//document.getElementById('d').innerHTML = "";
		my_div = document.getElementById('d');
		my_div.prepend(newDiv);
    //document.body.insertBefore(newDiv, my_div);
	//window.scrollBy(0, window.innerHeight);
};
function risuem_karty_igrokov(){
//var node=`div${hodit_igrok+1}`;
//document.removeChild(node);document.getElementById(`div${hodit_igrok+1}`)
var pokuda=1;
while(pokuda<kolichestvoIgrokov+1){document.getElementById(`div${pokuda}`).innerHTML='';
for (i=0; i<kartyIgrokov[pokuda-1].length; i++){
//`карты/${i}.jpg`
rk(kartyIgrokov[pokuda-1][i],pokuda);


//rk(igrok[0],ctx1);

//csl(igrok.length)
};
pokuda++;
}



};
function risuem (imaga,canva){
if(canva==0){var shirina=220/2; var visota=300/2;}
if(canva!=0){var shirina=50; var visota=100;}
ctxk.drawImage(imaga, ofX, ofY, rX, rY,0, 0,canvas.width,canvas.height);
var imk=new Image(shirina,visota);imk.crossOrigin = "anonymous";
if(canva==0){document.getElementById(`div0`).innerHTML='';}
imk.src=canvas.toDataURL();ctxk.clearRect(0, 0, canvas.width, canvas.height);
if(canva==5){imk.style.position='fixed';
imk.style.top='25px';imk.style.left='140px'} //110 150
document.getElementById(`div${canva}`).append(imk);
imk.onclick= function(){vrashat(imk)}};
function vrashat(i){

i.style.transform=`rotate(5deg)`;
csl(i.parentNode.id);
}
function rubashka(){ctxk.drawImage(img[6], 337, 0, 337, 531,0, 0,canvas.width,canvas.height);


var imk=new Image(220/2,300/2);imk.crossOrigin = "anonymous"
imk.src=canvas.toDataURL();ctxk.clearRect(0, 0, canvas.width, canvas.height);
imk.style.position='fixed';
document.getElementById(`div5`).append(imk)};
function rk(karta,canva){
switch (karta.n) {
  case "шесть пики":ofX=rX*1;ofY=rY*2;risuem(img[1],canva);break;
  case "шесть черви":ofX=rX*2;ofY=rY*2;risuem(img[1],canva);break;
  case "шесть бубны":ofX=rX*0;ofY=rY*0;risuem(img[2],canva);break;
  case "шесть крести":ofX=rX*1;ofY=rY*0;risuem(img[2],canva);break;
  
  case "семь бубны":ofX=rX*2;ofY=rY*0;risuem(img[2],canva);break;
  case "семь крести":ofX=rX*0;ofY=rY*1;risuem(img[2],canva);break;
  case "семь черви":ofX=rX*1;ofY=rY*1;risuem(img[2],canva);break;
  case "семь пики":ofX=rX*2;ofY=rY*1;risuem(img[2],canva);break;
  
  case "восемь черви":ofX=rX*0;ofY=rY*2;risuem(img[2],canva);break;
  case "восемь пики":ofX=rX*1;ofY=rY*2;risuem(img[2],canva);break;
  case "восемь бубны":ofX=rX*2;ofY=rY*2;risuem(img[2],canva);break;
  case "восемь крести":ofX=rX*0;ofY=rY*0;risuem(img[3],canva);break;
  
  case "девять бубны":ofX=rX*1;ofY=rY*0;risuem(img[3],canva);break;
  case "девять крести":ofX=rX*2;ofY=rY*0;risuem(img[3],canva);break;
  case "девять черви":ofX=rX*0;ofY=rY*1;risuem(img[3],canva);break;
  case "девять пики":ofX=rX*1;ofY=rY*1;risuem(img[3],canva);break;
  
  case "десять бубны":ofX=rX*2;ofY=rY*1;risuem(img[3],canva);break;
  case "десять пики":ofX=rX*0;ofY=rY*2;risuem(img[3],canva);break;
  case "десять черви":ofX=rX*1;ofY=rY*2;risuem(img[3],canva);break;
  case "десять крести":ofX=rX*2;ofY=rY*2;risuem(img[3],canva);break
  
  case "валет пики":ofX=rX*0;ofY=rY*0;risuem(img[4],canva);break;
  case "валет бубны":ofX=rX*1;ofY=rY*0;risuem(img[4],canva);break;
  case "валет крести":ofX=rX*2;ofY=rY*0;risuem(img[4],canva);break;
  case "валет черви":ofX=rX*0;ofY=rY*1;risuem(img[4],canva);break
  
  case "дама крести":ofX=rX*1;ofY=rY*1;risuem(img[4],canva);break;
  case "дама черви":ofX=rX*2;ofY=rY*1;risuem(img[4],canva);break;
  case "дама пики":ofX=rX*0;ofY=rY*2;risuem(img[4],canva);break;
  case "дама бубны":ofX=rX*1;ofY=rY*2;risuem(img[4],canva);break
  
  case "король крести":ofX=rX*2;ofY=rY*2;risuem(img[4],canva);break;
  case "король черви":ofX=rX*0;ofY=rY*0;risuem(img[5],canva);break;
  case "король черви":ofX=rX*1;ofY=rY*0;risuem(img[5],canva);break;
  case "король пики":ofX=rX*2;ofY=rY*0;risuem(img[5],canva);break
  case "король бубны":ofX=rX*0;ofY=rY*1;risuem(img[5],canva);break;
  
  case "туз крести":ofX=rX*1;ofY=rY*1;risuem(img[5],canva);break;
  case "туз черви":ofX=rX*2;ofY=rY*1;risuem(img[5],canva);break;
  case "туз пики":ofX=rX*0;ofY=rY*2;risuem(img[5],canva);break
  case "туз бубны":ofX=rX*1;ofY=rY*2;risuem(img[5],canva);break
   
  };
};
function ct(){

for (i=0; i<36; i++){cards.push({})};
for (i=0; i<9; i++){cards[i].m='пики'};
for (i=9; i<9*2; i++){cards[i].m='крести'};
for (i=9*2; i<9*3; i++){cards[i].m='черви'};
for (i=9*3; i<9*4; i++){cards[i].m='бубны'};
for (i=0; i<36; i++){
y=0;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='шесть';cards[i].ochki=6;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='семь';cards[i].ochki=7;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='восемь';cards[i].ochki=8;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='девять';cards[i].ochki=0;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='десять';cards[i].ochki=10;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='валет';cards[i].ochki=2;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='дама';cards[i].ochki=3;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='король';cards[i].ochki=4;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='туз';cards[i].ochki=11;};y=0;

					}
for (i=0; i<36; i++){cards[i].n=(cards[i].d+' '+cards[i].m);
cards[i].ves=0;cards[i].sw=0;
vsekarty=[]=cards.slice();
};
cards.find(i=>i.n=='король пики').ochki=12;




}
function zm(nabor){
		mast.p=0;
		mast.k=0;
		mast.c=0;
		mast.b=0;
		mast.n='не определено';
		mast.m=0;

		for(i=0; i<nabor.length;i++){
			if (nabor[i].m==1) mast.p++;
			if (nabor[i].m==2) mast.k++;
			if (nabor[i].m==3) mast.c++;
			if (nabor[i].m==4) mast.b++;
		}
		
		if (mast.p>0 && mast.p==mast.k){csl('одинаково пик и крестей')};
		if (mast.p>0 && mast.p==mast.c){csl('одинаково пик и червей')};
		if (mast.p>0 && mast.p==mast.b){csl('одинаково пик и бубей')};
		if (mast.k>0 && mast.k==mast.c){csl('одинаково крестей и червей')};
		if (mast.k>0 && mast.k==mast.b){csl('одинаково крестей и бубей')};
		if (mast.c>0 && mast.c==mast.b){csl('одинаково червей и бубей')};
		
		csl('пикей в руке '+mast.p);
		csl('крестей в руке '+mast.k);
		csl('червей в руке '+mast.c);
		csl('бубей в руке '+mast.b);

		if (mast.p>mast.k && mast.p>mast.c && mast.p>mast.b){csl('больше пик');mast.m=1;mast.n='пики'}
		if (mast.k>mast.p && mast.k>mast.c && mast.k>mast.b){csl('больше крестей');mast.m=2;mast.n='крести'}
		if (mast.c>mast.k && mast.c>mast.p && mast.c>mast.b){csl('больше червей');mast.m=3;mast.n='черви'}
		if (mast.b>mast.k && mast.b>mast.p && mast.b>mast.c){csl('больше бубей');mast.m=4;mast.n='буби'}
		if (mast.n=='не определено'){mast.m=rnd(1,4);csl('масть случайна.')};
		if (mast.m==1)mast.n='пики';
		if (mast.m==2)mast.n='крести';
		if (mast.m==3)mast.n='черви';
		if (mast.m==4)mast.n='буби';
};
function peretus(arr){
		var j, temp;
		for(var i = arr.length - 1; i > 0; i--){
		j = Math.floor(Math.random()*(i + 1));
		temp = arr[j];
		arr[j] = arr[i];
		arr[i] = temp;}
		return arr;
}
function getMaxOfArray(numArray) {
  return Math.max.apply(null, numArray);
};
function BeretKarty(){rk(cards[0],hodit_igrok+1);kartyIgrokov[hodit_igrok].push(cards.shift());
if(!cards.length){peretus(coloda); for(var k of coloda){cards.push(k)};coloda=[];}};
function dob_k(name,igrok,ist){
if (ist.find(i=>i.n==name)){
kartyIgrokov[igrok].push(ist.splice(ist.indexOf(ist.find(i=>i.n==name)),1)[0]);
rk(kartyIgrokov[igrok][kartyIgrokov[igrok].length-1],igrok+1)}};
function p_k(js,igrok){
//js.splice(0,1,"'");js.splice(js.length-1,1,"'");
mkkj=JSON.parse(js);
document.getElementById(`div${igrok+1}`).innerHTML='';
for (mj of mkkj){rk(mj,igrok+1)};
kartyIgrokov[igrok]=mkkj;}
function d_k(name,igrok){
kartyIgrokov[igrok].push(vsekarty.find(i=>i.n==name));
rk(kartyIgrokov[igrok][kartyIgrokov[igrok].length-1],igrok+1)};
function obr_hod(igrok){kartyIgrokov[igrok].push(coloda.pop());
rk(kartyIgrokov[igrok][kartyIgrokov[igrok].length-1],igrok+1);rk(coloda[coloda.length-1],0);kon=coloda[coloda.length-1];nuznMast=kon.m;hodit_igrok=igrok;};
function razd(){
		for (i=0; i<kolichestvoIgrokov; i++){
		kartyIgrokov.push([]);kartyIgrokov[i].n='Игрок номер ' + (i+1);
		for (y=0; y<po_skolko_kart; y++){
		kartyIgrokov[i].push(cards.shift());
		kartyIgrokov[i][y].i=index_karty;index_karty++;
		if (index_karty==po_skolko_kart){index_karty=0}}};
		//незнаю нужен ли будет индеск ну оставлю покачто
		//kon=cards[nk];nk++;
		kon=kartyIgrokov[hodit_igrok].shift();//rk(kon,ctx);
		coloda.push(kon);
		nuznMast=kon.m;
		if(kon.n=='король пики'){smena_igroka();let i = 0;while (i < 4){BeretKarty(); i++;}smena_igroka();return};
		switch (kon.d) {
  case "шесть":smena_igroka(); BeretKarty();break;
  case "семь":smena_igroka();let i = 0;while (i < 2){BeretKarty(); i++;};break;
  case "туз":smena_igroka();break;
  case "дама":zakaz_masty();break;
  case "девять":return;
  };
smena_igroka();
		
		//smena_igroka();
		//csl("в колоди осталося "+cards.length + " карт","green")
		//csl("накону " + kon.n);
};
function proverka_sovpadeniy(){

sovpadNaRukah=[];

for (i=0; i<kartyIgrokov[hodit_igrok].length; i++){
if (kartyIgrokov[hodit_igrok][i].d=='дама'){sovpadNaRukah.push(kartyIgrokov[hodit_igrok][i])}else{
if (kartyIgrokov[hodit_igrok][i].m==nuznMast){sovpadNaRukah.push(kartyIgrokov[hodit_igrok][i])};
if (kartyIgrokov[hodit_igrok][i].d==kon.d ){sovpadNaRukah.push(kartyIgrokov[hodit_igrok][i])}
}}};

function kartu_izyat(indexsbroshenoi,h){
var skartinki=document.getElementById(`div${h+1}`);
skartinki.removeChild(skartinki.children[indexsbroshenoi]);
kartyIgrokov[h].splice(indexsbroshenoi,1);};
function kartu_naKon(){obnulenie_parametrov();kon=sovpadNaRukah[0];nuznMast=kon.m;rk(kon,0);
var indexsbroshenoi=kartyIgrokov[hodit_igrok].indexOf(kon);kartu_izyat(indexsbroshenoi,hodit_igrok);

if (!kartyIgrokov[hodit_igrok].length && kon.d!='девять'){csl('   ИГРА ОКОНЧЕНА!!!!!!','red');
switch (kon.d) {
  case "шесть":smena_igroka(); BeretKarty();hodit_igrok=pred_igrok();break;
  case "семь":smena_igroka();let i = 0;while (i < 2){BeretKarty(); i++;};hodit_igrok=pred_igrok();break;
  };if(kon.n=='король пики'){smena_igroka();let i = 0;while (i < 4){BeretKarty(); i++;};hodit_igrok=pred_igrok();};podschet_ochkov();return};
coloda.push(kon);
switch (kon.d) {
  case "шесть":smena_igroka(); BeretKarty();break;
  case "семь":smena_igroka();let i = 0;while (i < 2){BeretKarty(); i++;};break;
  case "туз":smena_igroka();break;
  case "дама":zakaz_masty();break;
  case "девять":return;
  };

if(kon.n=='король пики'){smena_igroka();let i = 0;while (i < 4){BeretKarty(); i++;}};
smena_igroka();};

function zakaz_masty(){

pi=[];ch=[];kr=[];bu=[];
for(let mast of kartyIgrokov[hodit_igrok]){
switch (mast.m){
case "пики":pi.push(mast); break;
case "крести":kr.push(mast);break;
case "бубны":bu.push(mast);break;
case "черви":ch.push(mast);break;}};
mast=[];mast.push(pi,ch,kr,bu);mast.sort((b,a)=>a.length-b.length);nuznMast=mast[0][0].m;
zamenennayadama={};zamenennayadama.n='дама ' +nuznMast;rk(zamenennayadama,0)};


function zakaz_masty2(){var masty=[0,0,0,0];
for(let mast of kartyIgrokov[hodit_igrok]){
switch (mast.m) {
  case "пики":masty[0]++; break;
  case "крести":masty[1]++;break;
  case "бубны":masty[2]++;break;
  case "черви":masty[3]++;break;
  }};
  //какой масти сколько 
var ovm=[0,0,0,0];
for(let mast of kartyIgrokov[hodit_igrok]){
switch (mast.m) {
  case "пики":ovm[0]+=mast.ochki; break;
  case "крести":ovm[1]+=mast.ochki;break;
  case "бубны":ovm[2]+=mast.ochki;break;
  case "черви":ovm[3]+=mast.ochki;break;
  }};

var SbObshVesMast=getMaxOfArray(ovm);
var stmast;
switch (ovm.indexOf(SbObshVesMast)) {
  case 0:stmast='пики'; break;
  case 1:stmast='крести';break;
  case 2:stmast='бубны';break;
  case 3:stmast='черви';break;};
//в какой масти (верхняя) больше очков


fsbo=[];
for(var dost of kartyIgrokov[hodit_igrok]){fsbo.push(dost.ochki)};
var sbo=getMaxOfArray(fsbo);
//самое большое очко в картах игрока
for(var dost of kartyIgrokov[hodit_igrok]){if (sbo==3 && dost.d=='девять'&&dost.m!='пики'){stmast=dost.m};break;};
//если самое большое очко у дамы - берется масть девятки (верхней), но не пики
for(var dost of kartyIgrokov[hodit_igrok]){if (kartyIgrokov[hodit_igrok].length==2 && dost.m!='пики'){stmast=dost.m};break;};
//ЕСЛИ У ИГРОКА ВСЕГО ДВЕ КАРТЫ -берется масть которая не пики
for(var dost of kartyIgrokov[hodit_igrok]){if (sbo==3 && dost.d=='девять' ){stmast=dost.m};break;};
//если самое большое очко у дамы - берется масть девятки (верхней)

if (kartyIgrokov[hodit_igrok].length==1 && kartyIgrokov[hodit_igrok][0].d=='дама'){stmast=kartyIgrokov[hodit_igrok][0].m};
//ЕСЛИ У ИГРОКА ВСЕГО дама - её масть  и берется.


if(stmast=='пики'&&(kartyIgrokov[hodit_igrok].filter(i=>i.d!='дама'&&i.m!='пики').length>=kartyIgrokov[hodit_igrok].filter(i=>i.d!='дама'&&i.m=='пики').length)&&!kartyIgrokov[hodit_igrok].find(i=>i.n=='король пики'))stmast=kartyIgrokov[hodit_igrok].find(i=>i.d!='дама'&&i.m!='пики').m;
//если не-пикей больше чем пикей и нет короля пики - берется верхняя масть не пики

if(kartyIgrokov[hodit_igrok].length<4&&kartyIgrokov[hodit_igrok].find(i=>i.d=='шесть'||i.d=='семь'))stmast=kartyIgrokov[hodit_igrok].find(i=>i.d=='шесть'||i.d=='семь').m;
//если у игрока меньше четырех карт, и в картах есть шесть или семь (верхняя), беерется масть шесть или семь(верхняя),

postroyka_variaciy();vesa=[];for (y=0; y<kartyIgrokov[hodit_igrok].length; y++){vesa.push(kartyIgrokov[hodit_igrok][y].ves)};
var SbVES=getMaxOfArray(vesa);
//полчаются веса из постройки вариаций - находится верний самый большой вес

//if(!kartyIgrokov[hodit_igrok].find(i=>i.d=='дама')){stmast=kartyIgrokov[hodit_igrok][vesa.indexOf(SbVES)].m;};
// если кроме выложеной на кон дамы в картах игрока нет ещё дамы, берется масть карты с самым большим весом.

//если карта однв
if (kartyIgrokov[hodit_igrok].length==1){stmast=kartyIgrokov[hodit_igrok][0].m};
//если всегод одна карта то ее масть берется

//на кону рисуется нужная масть
zamenennayadama={};nuznMast=stmast;zamenennayadama.n='дама ' +stmast;rk(zamenennayadama,0)};


function smena_igroka(){

if(hodit_igrok==kolichestvoIgrokov-1){document.getElementById(`div${hodit_igrok+1}`).style.background="";}
//document.getElementById(`div${hodit_igrok+1}`).style.border="3px solid green";

hodit_igrok++; if (hodit_igrok>kolichestvoIgrokov-1){hodit_igrok=0}

document.getElementById(`div${hodit_igrok+1}`).style.background="green";
document.getElementById(`div${hodit_igrok}`).style.background="";
};
function sled_igrok(){var si=hodit_igrok+1;if (si>kolichestvoIgrokov-1){si=0};return si;};
function pred_igrok(){var pi=hodit_igrok-1;if (pi<0){pi=kolichestvoIgrokov-1};return pi;};
function obnulenie_parametrov(){
for (i=0; i<kartyIgrokov[hodit_igrok].length;i++){
			kartyIgrokov[hodit_igrok][i].ves=0;
			}};

function hod(){sovpadNaRukah=[];proverka_sovpadeniy();rubashka();nH==false;
log('~~~~~~~~~~~');
for (s of kartyIgrokov[hodit_igrok]){
switch (s.d) {
  case 'девять':s.ves=9;break;
  case 'семь':s.ves=7;break;
  case 'шесть':s.ves=6;break;
  case 'туз':s.ves=5;break;
  case 'десять':s.ves=4;break;
  case 'восемь':s.ves=3;break;
  case 'король':s.ves=2;break;
  case 'валет':s.ves=1;break;
  case 'дама':s.ves=-5;break;
 }
 if (s.n=='король пики')s.ves=8;
 if (s.n=='дама пики')s.ves=-8;
 };

if (sovpadNaRukah.length==0){BeretKarty();
rk(kartyIgrokov[hodit_igrok][kartyIgrokov[hodit_igrok].length-1],5);proverka_sovpadeniy();
if (sovpadNaRukah.length==0){if(kon.d!="девять")smena_igroka();return;}};

if (sovpadNaRukah.length==1){kartu_naKon();return;};

if (sovpadNaRukah.length==2&&sovpadNaRukah.find(i=>i.d=='дама')&&sovpadNaRukah.find(i=>i.d!='дама')){sovpadNaRukah[0]=sovpadNaRukah.find(i=>i.d!='дама');kartu_naKon();return;}
if (!sovpadNaRukah.filter(i=>i.d!='дама').length){if (ndp=sovpadNaRukah.find(i=>i.n!='дама пики')){sovpadNaRukah[0]=ndp}else{sovpadNaRukah[0]=sovpadNaRukah.find(i=>i.n=='дама пики')}kartu_naKon();return;};
if (sovpadNaRukah.length>1){postroyka_variaciy();}

};

function postroyka_variaciy(){
var i=0; nnn=[];nnn.push([]);mmm=[];K={};//proverka_sovpadeniy();
var sO=sovpadNaRukah;sO.sort((b,a)=>a.ves-b.ves);sO=sO[0].ves;
var karty_igroka=[];for (var k of kartyIgrokov[hodit_igrok]){if (k.d!='дама')karty_igroka.push(k)};
for (k of kartyIgrokov[hodit_igrok]){if(k.d=="шесть"||k.d=="семь"||k.d=="девять"||k.d=="туз"||k.n=="король пики"){k.pr=true;}
else{k.pr=false}};

for (var c of karty_igroka){for (var cc of karty_igroka){
if (cc!=c && ( cc.d==c.d || cc.m==c.m )){nnn[0].push([]); nnn[0][i].push(c,cc);i++;}}}mmm=nnn.slice();

if(nnn[0].length){
ioio=[];for (iii of nnn[0]){log('вошёл в иом');if(!iii.find(i=>i.pr==false))ioio.push(iii);}nnn[0]=ioio;
labN: for (var z=1;;z++){nnn[z]=[];for (j of nnn[z-1]){
for (m of nnn[0]){if(j[j.length-1]==m[0]&&j.indexOf(m[1])==-1){
nnn[z].push([]);nnn[z][nnn[z].length-1]=nnn[z][nnn[z].length-1].concat(j.slice(0,j.length-1),m)}}}
if (!nnn[z].length) break labN;}
nnn[nnn.length-1]=nnn[nnn.length-2].filter(u=>sovpadNaRukah.indexOf(u[0])!=-1);
if(nnn[nnn.length-1].length>1){sbv=[];for(n of nnn[nnn.length-1]){sbv.push(n[0])};sbv.sort((b,a)=>a.ves-b.ves);
K=sbv[0];sovpadNaRukah[0]=K;log(K.n+' cbv[0]');kartu_naKon();return;}
else{if (nnn[nnn.length-1].length){K=nnn[nnn.length-1][0][0];sovpadNaRukah[0]=K;log(K.n+' nnn[0]');kartu_naKon();return;}};};

if(mmm[0].length){
labM: for (var z=1;;z++){mmm[z]=[];for (j of mmm[z-1]){
for (m of mmm[0]){if(j[j.length-1]==m[0]&&j.indexOf(m[1])==-1){
mmm[z].push([]);mmm[z][mmm[z].length-1]=mmm[z][mmm[z].length-1].concat(j.slice(0,j.length-1),m)}}}
if (!mmm[z].length) break labM;}
M: for (i=2;;){if (mmm[mmm.length-i].filter(u=>sovpadNaRukah.indexOf(u[0])!=-1).length){
mmm[mmm.length-1]=mmm[mmm.length-i].filter(u=>sovpadNaRukah.indexOf(u[0])!=-1);break M}
else{if(mmm[mmm.length-i]==mmm[0]){break M}else{i++}}}
if(mmm[mmm.length-i].length){sbv=[];for(m of mmm[mmm.length-1]){sbv.push(m[0])};sbv.sort((b,a)=>a.ves-b.ves);
K=sbv[0];sovpadNaRukah[0]=K;log(K.n+' mmm[0]');kartu_naKon();return;}};
 

 log('не вышло');

//if (iom.length){ioi=iom.filter(i=>i[0].pr==true);sioi=ioi;}

//if (ioi.length){ioi=ioi.filter(i=>i[1].pr==true);}




//if (iom.length){var dsdc=iom[iom.length-1].length;ioi=iom.filter(i=>i.length==dsdc);sioi=ioi;
//for(u=0;u<dsdc;u++){oio=ioi.filter(i=>i[u].pr==true);if(!oio.length){break;}else{ioi=oio}}};
//if(sioi!=ioi||ioi.length&&ioi[0][0].pr)K=ioi[0][0];

//if (iom.length){ioi=iom.filter(i=>i[0].pr==true);sioi=ioi;var dsdc=ioi[ioi.length-1].length-2;
//for(u=0;;u++){oio=ioi.filter(i=>i[u].pr==true);if(!oio.length){break;}else{ioi=oio}}};
//if(sioi!=ioi||ioi.length&&ioi[0][0].pr)K=ioi[0][0];


//попорядку ??????????????
//for (s of sovpadNaRukah){
//switch (s.d) {
 // case 'девять':K=s;break;
 // case 'семь':K=s;break;
 // case 'шесть':K=s;break;
 // case 'туз':K=s;break;
 // case 'десять':K=s;break;
 // case 'восемь':K=s;break;
 // case 'король':K=s;break;
 // case 'валет':K=s;break;
 // case 'дама':K=s;break;
// }};

 //sovpadNaRukah[0]=K;kartu_naKon();return;
//sovpadNaRukah[0]=piom[0][0];kartu_naKon();log('piom по очам');}
//sovpadNaRukah[0]=sovpadNaRukah[vesa.indexOf(SbVES)];
//kartu_naKon();



}

function log(x){console.log(x);};

function postroyka_logiki(){


var massivOchey=[];var Samoebolshoeochko=0; 
for (y=0; y<sovpadNaRukah.length; y++){massivOchey.push(sovpadNaRukah[y].ochki)}; 
Samoebolshoeochko=getMaxOfArray(massivOchey);
var indeksochka=-1;
for (i=0; i<massivOchey.length; i++){indeksochka=massivOchey.indexOf(Samoebolshoeochko,indeksochka+1);
if (indeksochka!=-1){sovpadNaRukah[indeksochka].ves+=3; log(sovpadNaRukah[indeksochka].n+ 'Samoebolshoeochko ves+3');}
else{i=massivOchey.length};}
//веса для специальных карт
	

if 	(kartyIgrokov[sled_igrok()].length==1){
for (y=0; y<sovpadNaRukah.length; y++){
if(sovpadNaRukah[y].n=='дама пики'){sovpadNaRukah[y].ves-=5;log('св 2 дама пики -5 ')}
if(sovpadNaRukah[y].n=='король пики'){sovpadNaRukah[y].ves+=40;log('св 2 король пики +40')}
switch (sovpadNaRukah[y].ochki) {
  case 3:sovpadNaRukah[y].ves-=5;break;log('св 2 дама -5');
  case 6:sovpadNaRukah[y].ves+=40;break;log('св 2 шесть +40');
  case 7:sovpadNaRukah[y].ves+=40;break;log('св 2 семь +40');
  
  case 10:sovpadNaRukah[y].ves+=10;break;log('св 2 10 +10');
  case 11:sovpadNaRukah[y].ves+=20;break;log('св 2 туз +20');
}}};
//if(sovpadNaRukah.find(i=>i.d=='девять')){
//if(iom.find(i=>i[0].d=='девять'&&i[i.length-1].d!='девять'))



	postroyka_variaciy();
//if (sovpadNaRukah.length==2&&kolichestvoIgrokov==2&&sovpadNaRukah.find(i=>i.d=='туз'||i.d=='туз'||
	proverka_sovpadeniy();
			vesa=[];
			for (y=0; y<sovpadNaRukah.length; y++){vesa.push(sovpadNaRukah[y].ves)};
			var SbVES=getMaxOfArray(vesa);			
			document.getElementById(`d`).innerHTML = "";
			csl (kon.n);
			for(var k of kartyIgrokov[hodit_igrok]){csl(k.n +' '+ k.ves)};
			sovpadNaRukah[0]=sovpadNaRukah[vesa.indexOf(SbVES)];
			kartu_naKon();
				
					
															
															
															
};//конец функции логики						
ct();peretus(cards);razd();
</script>
</body>
</html>