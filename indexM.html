<!DOCTYPE html>
<html lang="en">
	<head>
		<title>С Новым Годом!</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, height=device-height, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				margin: 0px;
				overflow: hidden;
			};
		</style>
	</head>
	<body>
  <script src="./lib/three.min.js"></script>
  <script src="./lib/OrbitControls.js"></script>
  <script src="./lib/GLTFLoader.js"></script>
  <script>
  var clock = new THREE.Clock();
	const x=new THREE.Vector3( 1, 0, 0);
	const y=new THREE.Vector3( 0, 1, 0);
	const z=new THREE.Vector3( 0, 0, 1);
  var lights=[];var t=[];var com=[];var mixers=[];var act=[];var snegok=[];
  t['elochkagory']=0;
  var texture;
	texture=new THREE.TextureLoader().load( "https://sun9-39.userapi.com/c855736/v855736064/1b9a48/kp92dUpYYOI.jpg");
	var bump;
  var pol, elka, snegurka, sneginka, ded, god, sneg, materialSnega;
  function rnd(a,b) {return a+Math.floor(Math.random()*(b-a+1))};
  init();
  function init() {

  camera = new THREE.PerspectiveCamera( 36, window.innerWidth / window.innerHeight, 1, 100);
  camera.position.set(-9.440743895144852,20.045642125452467,22.721579057195235);
	camera.quaternion.set(-0.18866292375413787,0.006427398261990288,0.0012348135803620453,0.9820200939835925);
  scene = new THREE.Scene();
  renderer = new THREE.WebGLRenderer( { antialias: true } );
  renderer.setPixelRatio( window.devicePixelRatio );
  renderer.setSize( window.innerWidth, window.innerHeight );
  document.body.appendChild( renderer.domElement );
  controls = new THREE.OrbitControls( camera, renderer.domElement );
  controls.zoomSpeed=3;
  controls.keys=0;
  controls.target.set(-10,3,-20);
	camera.lookAt(controls.target);
  controls.minPolarAngle=Math.PI/4;
  controls.maxPolarAngle=Math.PI/2.5;
  controls.maxAzimuthAngle=Math.PI/4;
  controls.minAzimuthAngle=-Math.PI/4;
  controls.minDistance=27;
  controls.maxDistance=46;
  pol=new THREE.Mesh(new THREE.PlaneGeometry( 100, 100 ),new THREE.MeshPhongMaterial( {side: THREE.DoubleSide}));
  pol.material.color.b=(10000000);
  pol.rotation.x=-1.570796326794897;
  pol.receiveShadow = true;
  scene.add(pol);
  var loader = new THREE.GLTFLoader();
  loader.load( 'models/elk.glb', function ( load ) {
  elka = load;
  elka.scene.position.set(-10,0,-20);
  lights['elka'] = new THREE.SpotLight();
  lights['elka'].position.set(-10,12,-20);
  lights['elka'].color.setStyle('#39E24D');
  lights['elka'].intensity=15;
  lights['elka'].distance=12;
  lights['elka'].decay=2;
  lights['elka'].angle=3.14;
  scene.add(lights['elka']);

	elka.scene.getObjectByName('ель').material.map=texture;
  elka.scene.getObjectByName('ель').material.bumpMap=texture;
  elka.scene.getObjectByName('ель').material.roughness=0.7;
  elka.scene.getObjectByName('красные').material.metalness=1;
  elka.scene.getObjectByName('красные').material.emissiveIntensity=0.1;
  elka.scene.getObjectByName('красные').material.roughness=0;
  elka.scene.getObjectByName('желтые').material.metalness=0.8;
  elka.scene.getObjectByName('желтые').material.emissiveIntensity=0.8;
  elka.scene.getObjectByName('желтые').material.roughness=0.1;
  scene.add(elka.scene);com['elochkagory']=true;
  });
  loader.load( 'models/sn.glb', function ( load ) {
  snegurka=load;
  mixers['snegurka'] = new THREE.AnimationMixer(snegurka.scene);
  act['poklon']=mixers['snegurka'].clipAction( THREE.AnimationClip.findByName( snegurka.animations, 'поворот' ));
  snegurka.scene.getObjectByName('Скелет').position.set(-14,0,-12)
  lights['snegurka'] = new THREE.SpotLight();
  lights['snegurka'].position.set( -10, 3, -8 );
  lights['snegurka'].target=snegurka.scene.getObjectByName('Скелет');
  lights['snegurka'].intensity=1.5;
  lights['snegurka'].distance=15;
  lights['snegurka'].angle=1.2;
  scene.add( lights['snegurka']);
  scene.add(snegurka.scene);
  act['poklon'].timeScale=0.5;
  act['poklon'].play();
  });
  loader.load( 'models/sneginka.glb', function ( load ) {
  sneginka=load;
  //sneginka.scene.children[0].material.side=2;
  sneg =new THREE.Object3D;
	materialSnega=new THREE.MeshBasicMaterial( {side:THREE.DoubleSide});
  scene.add(sneg);cSneg(202);
  });
  loader.load( 'models/dm.glb', function ( load ) {
  ded=load;
  mixers['ded'] = new THREE.AnimationMixer(ded.scene);
  act['ded']=mixers['ded'].clipAction( THREE.AnimationClip.findByName( ded.animations, 'хлоп' ));
  ded.scene.getObjectByName('Скелет').position.set(-5,0,-14);
  lights['ded'] = new THREE.SpotLight();
  lights['ded'].position.set( -10, 3, -8 );
  lights['ded'].target=ded.scene.getObjectByName('Скелет');
  lights['ded'].intensity=2;
  lights['ded'].distance=15;
  lights['ded'].angle=1.2;
  scene.add(ded.scene, lights['ded']);
  act['ded'].play();});
  loader.load( 'models/2020.glb', function ( load ) {
  god=load;
  god.scene.position.set(-10,0,-15);
  scene.add(god.scene);
  });
  };
  function cSneg(kolvo){
    for (i=0;i<kolvo;i++){
		snegok[i]=new THREE.Mesh(sneginka.scene.children[0].geometry,materialSnega);
		var rs=(rnd(1,99))/1000;
    snegok[i].scale.x=rs;
    snegok[i].scale.y=rs;
    snegok[i].scale.z=rs;
    snegok[i].position.x=rnd(-20, 0);
    snegok[i].position.y=rnd(20, 35);
    snegok[i].position.z=rnd(-5,-20);
    snegok[i].rotation.x=rnd(0,Math.PI*2);
    snegok[i].rotation.y=rnd(0,Math.PI*2);
    snegok[i].rotation.z=rnd(0,Math.PI*2);

    sneg.add(snegok[i])};
    com['snegopad']=true;
    animate();};
    function animate() {
    requestAnimationFrame( animate);
    var delta = clock.getDelta();

    if (mixers['snegurka']) mixers['snegurka'].update(delta);
    if (mixers['ded']) mixers['ded'].update(delta);
    if (com['elochkagory']==true){
    t['elochkagory']++;
    if (t['elochkagory']<=20)elka.scene.getObjectByName('желтые').material.emissiveIntensity+=0.2;
    if (t['elochkagory']>20)elka.scene.getObjectByName('желтые').material.emissiveIntensity-=0.2;
    if (t['elochkagory']==40)t['elochkagory']=0;
    };
    if (com['snegopad']==true){
    if (sneg.children.length<101)cSneg(202);
    sneg.children.forEach(function(child) {
    child.position.y-=0.02;
    child.rotateOnWorldAxis(y,Math.PI/rnd(45,90));
    child.rotateOnWorldAxis(x,Math.PI/rnd(45,90));
    if (child.position.y<2) {
			child.position.set(rnd(-20, 0), rnd(20, 35), rnd(-5,-20));
		};
    });
    };
    renderer.render( scene, camera );
    };


  </script>
  </body>
  </html>
