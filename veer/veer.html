<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />

<style>
.veer{
position:absolute;
width:100%;
height:0%;

left: 0%;
transform-origin: 50% 80% 0;

}
.stol{
position:absolute;

}
.pole{
position:absolute;
width:165px;
height:255px;
border: 8px solid white;
box-sizing: border-box;
background-origin: border-box;

box-shadow: 0 0 10px rgba(0,0,0,0.5);
border-radius:5%;

left:00px;
transform-origin: 50% 100% 0;
background-color: #FF7373;

}

.poles{
position:absolute;
width:34.65px;
height:53.55px;

box-shadow: 0 0 1px rgba(0,0,0,1);
border-radius:5%;

left:00px;
transform-origin: 50% 100% 0;
background-color: #FF7373;

}
#win{
position: absolute;
width:600px;
height:540px;
border: 4px double black;
border-radius:5%;
background-color: green;
z-index: -10;
}

.sk{background-color: blue;
	width:200px;
	height:200px;
transform-origin: 0% 0% 0%;
 position: absolute;

 margin: 0px;
 padding: 0px;
}

.coloda{

	position: absolute;
	width:110px;
	height:170px;
	top:20px;
	left:120px;
box-shadow: 2px 10px 2px 2px rgba(20,0,150,0.5);
box-sizing: border-box;
background-origin: border-box;
	border-radius:5%;
	background-color: blue;
}
.krugok{
	position: absolute;
	width:10px;
	height:10px;
	border-radius:50%;
	top:10px;
	left:90px;
	background-color: red;
	border: 1px double black;
}
.mess{

	position: absolute;
	width:400px;
	text-align: center;
	font-size: 20px;
	top:220px;
	left:120px;
box-shadow: 2px 10px 2px 2px rgba(20,0,150,0.5);
box-sizing: border-box;
background-origin: border-box;
	border-radius:5%;
	background-color: yellow;
}
</style>
</head>
<body>
<div id='win'>
<div class='stol'>
<div class='veer'></div>
</div>
<div class='stol'>
<div class='veer'></div>
</div>
<div class='stol'>
<div class='veer'></div>
</div>

<div class='coloda'></div>
<div class='coloda'></div>


<div class='coloda'>
<div class='stol'>
<div class='veer'></div>
</div>
<div class='stol'>
<div class='veer'></div>
</div>
<div class='stol'>
<div class='veer'></div>
</div></div>


<div class='coloda'>
<div class='stol'>
<div class='veer'></div>
</div>
<div class='stol'>
<div class='veer'></div>
</div>
<div class='stol'>
<div class='veer'></div>
</div></div>


<div class='coloda'>
<div class='stol'>
<div class='veer'></div>
</div>
<div class='stol'>
<div class='veer'></div>
</div>
<div class='stol'>
<div class='veer'></div>
</div></div>
</div>

<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-database.js"></script>
<script src="./baza.js"></script>
<script src="./cart.js"></script>
<script src="./otris.js"></script>

<script>
//110-170
var rB;var delayhod=false;
var canvas = document.createElement("CANVAS");var wh=5;var rX=340;var rY=525;var ofX=ofY=0;
canvas.width=1028/wh;canvas.height=1586/wh;var ctxk = canvas.getContext('2d');
var kartyIgrokov=[];var kon;var nk=0;var cards=[];var coloda=[];var sovpadNaRukah=[];var img=[];var loadImg=0;
var K={};snbd=[];snb=[];
var movem;
var player=[];var gid;var frB;var players=[];
var kolichestvoIgrokov=4,po_skolko_kart=5;index_karty=0;hodit_igrok=0;ochkiigrokow=[];var nH=false;
for (var i=1; i<7; i++){img[i] = document.createElement("IMG");img[i].src = `./cards/${i}.jpg`;
img[i].onload=function(){loadImg++;if(loadImg==6){rubashka();
	gastsBase.once('value', function(snapshot1) {gast=snapshot1.val();dataBase.update({gasts:gast+1});
	if(!gast){
		gastsBase.on('value', function(snapshot2) {gasts=snapshot2.val();gastsBase.onDisconnect().set(gasts-1);});

		player.id=dataBase.push().key;
		//player.push(player.id);
		//dataBase.child('room'+player.id).set(player.id);
		rB=firebase.database().ref('data/'+player.id+'/');
		rB.on('child_added',(adch)=>{player.push(adch.val())});
		dataBase.update({gid:player.id});
		rB.child(gast).set(player.id);
		gid=player.id;igroksmelisya();
		dataBase.child('room'+player.id).child('hi').update({hodit_igrok});
		dataBase.child('room'+player.id).child('hi').on('child_changed',(i)=>{hodit_igrok=i.val();if(gast==i.val()) {hodushty();}else{igroksmelisya(i.val());}})
dataBase.child('room'+gid).child('kon').on('value',(snap)=>{kon=snap.val()});
		//rB.child(gast).set(player.id);
		//rB = firebase.database().ref('data/'+player.id);
		//rB.child('keys').child(gast).set(player.id);

		//rB.onDisconnect().remove();
			//player.id=dataBase.push().key();
newH();

	}else{
		gastsBase.on('value', function(snapshot3) {gasts=snapshot3.val();gastsBase.onDisconnect().set(gasts-1);});
		player.id=dataBase.push().key;
		dataBase.once('value',(snap)=>{gid=snap.val().gid;
			frB=firebase.database().ref('data/'+gid+'/');
			dataBase.child('room'+gid).child('kon').on('value',(snap)=>{kon=snap.val()})
			frB.child(gast).set(player.id);
			frB.on('value',(vle)=>{players=vle.val();if(nevse&&players.length>=2){nevse=0;drugie();}
dataBase.child('room'+gid).child('hi').child('hodit_igrok').once('value',(i)=>{hodit_igrok=i.val();if(gast==i.val()) {hodushty()}else{igroksmelisya(i.val());} })
dataBase.child('room'+gid).child('hi').on('child_changed',(i)=>{hodit_igrok=i.val();if(gast==i.val()) {hodushty();}else{igroksmelisya(i.val());}})

			});
		})

		// frB=firebase.database().ref('data/'+gid+'/');
		// frB.on('child_added',(adch)=>{player.push(adch.val())});
		// frB.child(gast).set(player.id);





		//rB=firebase.database().ref('data/'+gid+'/');
		//rB.update({player});
		//rB = firebase.database().ref('data/'+gid);
		//dataBase.update({gid:player.id});
		//rB.child('keys').update(gid);
 		//dataBase
	}

});
		//newH();

}}};


function newH(){kartyIgrokov=[];cards=[];coloda=[];sovpadNaRukah=[];
ct();peretus(cards);razd();risuem_karty_igrokov();risk(kon,colod[1]);nH=false;
};


var zi=0;var sm=0;var pero={};pero.ix=0;pero.iy=0;pero.style=0;pero.style=0;md=false;var perop;
var zi1=0;var zi2=0; var zi3=0;
 stol=document.getElementsByClassName('veer');
 veerok=document.getElementsByClassName('stol');
 pole=document.getElementsByClassName('pole');
 poles1=document.getElementsByClassName('poles');
krugki=document.getElementsByClassName('krugok');
 win=document.getElementById('win');
 colod=document.getElementsByClassName('coloda');


	for(c of colod){c.style.zIndex=-1}
 colod[0].style.top='10px';colod[0].style.left='475px';
 colod[1].style.top='10px';colod[1].style.left='355px';
 colod[2].style.top='10px';colod[2].style.left='235px';colod[2].style.height='150px';
 colod[3].style.top='10px';colod[3].style.left='120px';colod[3].style.height='150px';
 colod[4].style.top='10px';colod[4].style.left='5px';colod[4].style.height='150px';
colod[4].appendChild(document.createElement('div')).className='krugok';
colod[3].appendChild(document.createElement('div')).className='krugok';
colod[2].appendChild(document.createElement('div')).className='krugok';
win.appendChild(document.createElement('div')).className='krugok';
krugki[3].style.top='495px';
krugki[3].style.left='20px';
krugki[3].style.width='25px';
krugki[3].style.height='25px';

stol[0].style.zIndex=0;stol[1].style.zIndex=1;stol[2].style.zIndex=2;
stol[0].py=+window.getComputedStyle(stol[0]).getPropertyValue('top').slice(0,-2);ty(stol[0],-220);
stol[1].py=+window.getComputedStyle(stol[1]).getPropertyValue('top').slice(0,-2);ty(stol[1],-260);
stol[2].py=+window.getComputedStyle(stol[2]).getPropertyValue('top').slice(0,-2);ty(stol[2],-280);
for(s of stol){s.rot=0};
stol[0].px=+window.getComputedStyle(stol[0]).getPropertyValue('left').slice(0,-2);tx(stol[0],170)
stol[1].px=+window.getComputedStyle(stol[1]).getPropertyValue('left').slice(0,-2);tx(stol[1],170);
stol[2].px=+window.getComputedStyle(stol[2]).getPropertyValue('left').slice(0,-2);tx(stol[2],170);
utx(stol[3],37.675);uty(stol[3],96);stol[3].style.zIndex=1;
utx(stol[4],37.675);uty(stol[4],82);stol[4].style.zIndex=2;
utx(stol[5],37.675);uty(stol[5],64);stol[5].style.zIndex=3;

utx(stol[6],37.675);uty(stol[6],96);stol[6].style.zIndex=1;
utx(stol[7],37.675);uty(stol[7],82);stol[7].style.zIndex=2;
utx(stol[8],37.675);uty(stol[8],64);stol[8].style.zIndex=3;

utx(stol[9],37.675);uty(stol[9],96);stol[9].style.zIndex=1;
utx(stol[10],37.675);uty(stol[10],82);stol[10].style.zIndex=2;
utx(stol[11],37.675);uty(stol[11],64);stol[11].style.zIndex=3;


for (i=0;i<3;i++){stol[i].addEventListener('mouseout',zatem,true);stol[i].addEventListener('mouseover',osvet,true);};
var popus;var sss;
function dkv(stlv) {ubrizcol();
if(stlv==1){
if (zi1<12)sss=stol[3];
if (zi1>=12)sss=stol[4];
if (zi1>=24)sss=stol[5];
}

if(stlv==2){
if (zi1<12)sss=stol[6];
if (zi1>=12)sss=stol[7];
if (zi1>=24)sss=stol[8];
}

if(stlv==3){
if (zi1<50)sss=stol[9];
if (zi1>=12)sss=stol[10];
if (zi1>=24)sss=stol[11];
}


sss.appendChild(document.createElement('div')).className='poles';

popus=sss.children[sss.children.length-1];
popus.rot=0;
popus.style.backgroundImage = 'url('+rubaha.src+')';
popus.style.backgroundSize='100%';
if(stlv==1){popus.zi=zi1;zi1++};
if(stlv==2){popus.zi=zi2;zi2++};
if(stlv==3){popus.zi=zi3;zi3++};
veer2();
}

function veer2(){var ss;
	  if (sss==stol[3])ss=0;if (sss==stol[4])ss=12;if (sss==stol[5])ss=24;
    if (sss==stol[6])ss=0;if (sss==stol[7])ss=12;if (sss==stol[8])ss=24;
	  if (sss==stol[9])ss=0;if (sss==stol[10])ss=12;if (sss==stol[11])ss=24;

//sss.style.transformOrigin='50% 100% 0';
 	rot(popus,(popus.zi+1-ss)*10);
// 	utx(popus,(popus.zi+1-ss)*1.5);
// 	rot(sss,-3*1.4);
rot(sss,-5);
uty(sss,2.8);
utx(sss,-3.26);
// 	uty(sss,1.5);
// 	utx(sss,-3.7);
// popus.style.zIndex=36-popus.zi;
// 	if(ss==12&&sss==stol[4]){uty(stol[3],-0.5)}
// 	if(ss==24&&sss==stol[5]){uty(stol[3],-0.5);uty(stol[4],-0.5)}
// 	if(ss==24){ty(stol[0],6);ty(stol[1],5);}
};
function rot (e,g){e.rot+=g; e.style.transform=`rotate(${e.rot}deg)`}
function ty(e,y){e.py-=y;e.style.top=e.py+'px';}
function tx(e,x){e.px+=x;e.style.left=e.px+'px';}

function utx(e,x){e.style.left=+window.getComputedStyle(e).getPropertyValue('left').slice(0,-2)+x+'px'};
function uty(e,x){e.style.top=+window.getComputedStyle(e).getPropertyValue('top').slice(0,-2)+x+'px'};

function veer(e,s){
	if (s==stol[0])ss=0;if (s==stol[1])ss=12;if (s==stol[2])ss=24;
	rot(e,(e.zi+1-ss)*10);
	tx(e,(e.zi+1-ss)*10);rot(s,-3.7);
	ty(s,-12);
	tx(s,-18);

	if(ss==12){ty(stol[0],3);ty(stol[1],0);}//ty(stol[0],3);rot(stol[0],-0.4);}
	if(ss==24){ty(stol[0],6);ty(stol[1],5);}
};

function dk(krt){ubrizcol();
						if (zi<12)s=stol[0];if (zi>=12)s=stol[1];if (zi>=24)s=stol[2];
						s.appendChild(document.createElement('div')).className='pole';
						var p=pole[pole.length-1];
						risk(krt,p);
						//console.log(krt,p);
					  p.rot=0;
            p.px=+window.getComputedStyle(p).getPropertyValue('left').slice(0,-2);
						p.py=+window.getComputedStyle(p).getPropertyValue('top').slice(0,-2);
            p.style.zIndex=zi;p.zi=zi;zi++;
						p.ondragstart = function() { return false};
    			  veer(p,s);

					}


function onMouseMove(event){perop.style.left=event.pageX-perop.ix+'px';
perop.style.top=event.pageY-perop.iy+'px';};



function osvet(e) {//e.path[0].style.backgroundColor='#FFC3C3';
p=e.path[0];
p.onmousedown = function(event) {
	//for(d of pole){if(d!=p)d.onmousedown=null}
	//console.log(e.pageY);
	movem=event.pageY;
	p.addEventListener('mousemove', onMouseMove);
	pero=p.parentNode.cloneNode(false);
	pero.addEventListener('mouseout',zatem,true);pero.addEventListener('mouseover',osvet,true);
	perop=p.parentNode.parentNode.cloneNode(false);
	document.body.append(perop);
	perop.append(pero);
	pero.append(p);
	p.zIndex=10000;

	for (i=0;i<3;i++){stol[i].removeEventListener('mouseout',zatem,true);stol[i].removeEventListener('mouseover',osvet,true)};
	pero.addEventListener('mouseout',zatem,true);pero.addEventListener('mouseover',osvet,true);
	perop.ix = event.pageX;
	perop.iy = event.pageY;
	perop.style.left=event.pageX-perop.ix+'px';
	perop.style.top=event.pageY-perop.iy+'px';
}

p.onmouseup = function(ee) {
	//p.onmouseup = null;
	p.removeEventListener('mousemove', onMouseMove);
	for (i=0;i<3;i++){stol[i].addEventListener('mouseout',zatem,true);stol[i].addEventListener('mouseover',osvet,true)};
//console.log(ee.clientY);console.log(e.clientY);
	//console.log(ee.clientY-e.clientY);
	movem=movem-ee.pageY;
	if(movem>0){vverhposhlo(p.style.zIndex);}else{vnizhposhlo();}
	if(p.style.zIndex<12){stol[0].append(p);return};
	if(p.style.zIndex<24){stol[1].append(p);return};
	stol[2].append(p);
}
}


function zatem(e){//e.path[0].style.backgroundColor='#FF7373';

e.path[0].removeEventListener('mousemove', onMouseMove);
for (i=0;i<3;i++){stol[i].addEventListener('mouseout',zatem,true);stol[i].addEventListener('mouseover',osvet,true)};
if (veerok[12])veerok[12].remove();

if(e.path[0].style.zIndex<12){stol[0].append(e.path[0]);return};
if(e.path[0].style.zIndex<24){stol[1].append(e.path[0]);return};
stol[2].append(e.path[0]);

}



itc=0;
//interval=setInterval(()=>{dk();itc++;if(itc>=36)clearInterval(interval)},500);



//pole[0].style.width=`${pole[0].getBoundingClientRect().height/20}px`
//# sourceURL=userscript.js
</script>
</body>
</html>
