<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />

<style>
.veer{
position:absolute;
width:100%;
height:0%;

left: 0%;
transform-origin: 50% 80% 0;
}
.stol{
position:absolute;
}
.pole{
position:absolute;
width:165px;
height:255px;
border: 10px solid white;
box-sizing: border-box;
background-origin: border-box;

box-shadow: 0 0 10px rgba(0,0,0,0.5);
border-radius:5%;

left:00px;
transform-origin: 50% 100% 0;
background-color: #FF7373;

}
#win{
position: absolute;
width:600px;
height:540px;
border: 4px double black;
border-radius:5%;
background-color: green;
z-index: -10;
}

.sk{background-color: blue;
	width:200px;
	height:200px;
transform-origin: 0% 0% 0%;
 position: absolute;

 margin: 0px;
 padding: 0px;
}

.coloda{

	position: absolute;
	width:110px;
	height:200px;
	top:20px;
	left:120px;
	border: 4px double black;
	border-radius:5%;
	background-color: blue;
}

</style>
</head>
<body>
<div id='win'>
<div class='stol'>
<div class='veer'></div>
</div>
<div class='stol'>
<div class='veer'></div>
</div>
<div class='stol'>
<div class='veer'></div>
</div>

<div class='coloda'></div><div class='coloda'></div>
<div class='coloda'></div>
<div class='coloda'></div>
<div class='coloda'></div>
</div>
<script>
//110-170
var canvas = document.createElement("CANVAS");var wh=5;var rX=340;var rY=525;var ofX=ofY=0;
canvas.width=1028/wh;canvas.height=1586/wh;var ctxk = canvas.getContext('2d');
var kartyIgrokov=[];var kon;var nk=0;var cards=[];var coloda=[];var sovpadNaRukah=[];var img=[];var loadImg=0;
var K={};snbd=[];snb=[];
var kolichestvoIgrokov=1,po_skolko_kart=5;index_karty=0;hodit_igrok=0;ochkiigrokow=[];var nH=false;
for (var i=1; i<7; i++){img[i] = document.createElement("IMG");img[i].src = `./карты/${i}.jpg`;
img[i].onload=function(){loadImg++;if(loadImg==6){rubashka();}}};
function rubashka() {
	ctxk.drawImage(img[6], 337, 0, 337, 531,0, 0,canvas.width,canvas.height);
	var imk=new Image(220/2,300/2);
	imk.src=canvas.toDataURL();imk.crossOrigin = "anonymous";

	ctxk.clearRect(0, 0, canvas.width, canvas.height);
	imk.style.position='fixed';
	//coloda[0].append(imk);
	colod[0].style.backgroundImage = 'url('+imk.src+')';
	colod[1].style.backgroundImage = 'url('+imk.src+')';


};
function newH(){kartyIgrokov=[];cards=[];coloda=[];sovpadNaRukah=[];
ct();peretus(cards);razd();risuem_karty_igrokov();//rubashka();rk(kon,0);nH=false;
};
function risuem_karty_igrokov(){
for(krt of kartyIgrokov[0]){dk(krt);}
};


function razd(){
		for (i=0; i<kolichestvoIgrokov; i++){
		kartyIgrokov.push([]);kartyIgrokov[i].n='Игрок номер ' + (i+1);
		for (y=0; y<po_skolko_kart; y++){
		kartyIgrokov[i].push(cards.shift());
		kartyIgrokov[i][y].i=index_karty;index_karty++;
		if (index_karty==po_skolko_kart){index_karty=0}}};
	  kon=kartyIgrokov[hodit_igrok].shift();
		coloda.push(kon);
		nuznMast=kon.m;
// 		if(kon.n=='король пики'){smena_igroka();let i = 0;while (i < 4){BeretKarty(); i++;}smena_igroka();return};
// 		switch (kon.d) {
//   case "шесть":smena_igroka(); BeretKarty();break;
//   case "семь":smena_igroka();let i = 0;while (i < 2){BeretKarty(); i++;};break;
//   case "туз":smena_igroka();break;
//   case "дама":zakaz_masty();break;
//   case "девять":return;
//   };
// smena_igroka();
  };
function peretus(arr){
		var j, temp;
		for(var i = arr.length - 1; i > 0; i--){
		j = Math.floor(Math.random()*(i + 1));
		temp = arr[j];
		arr[j] = arr[i];
		arr[i] = temp;}
		return arr;
}
function ct(){cards=[];
for (i=0; i<36; i++){cards.push({})};
for (i=0; i<9; i++){cards[i].m='пики'};
for (i=9; i<9*2; i++){cards[i].m='крести'};
for (i=9*2; i<9*3; i++){cards[i].m='черви'};
for (i=9*3; i<9*4; i++){cards[i].m='бубны'};
for (i=0; i<36; i++){y=0;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='шесть';cards[i].ochki=6;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='семь';cards[i].ochki=7;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='восемь';cards[i].ochki=8;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='девять';cards[i].ochki=0;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='десять';cards[i].ochki=10;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='валет';cards[i].ochki=2;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='дама';cards[i].ochki=3;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='король';cards[i].ochki=4;};y++;
if (i==0+y || i==9+y || i==18+y || i==27+y){cards[i].d='туз';cards[i].ochki=11;};y=0;}
for (i=0; i<36; i++){cards[i].n=(cards[i].d+' '+cards[i].m);
cards[i].ves=0;cards[i].sw=0;
vsekarty=[]=cards.slice()};
cards.find(i=>i.n=='король пики').ochki=12;
for (s of cards){
switch (s.d) {
  case 'девять':s.ves=9;break;
  case 'семь':s.ves=7;break;
  case 'шесть':s.ves=6;break;
  case 'туз':s.ves=5;break;
  case 'десять':s.ves=4;break;
  case 'восемь':s.ves=3;break;
  case 'король':s.ves=2;break;
  case 'валет':s.ves=1;break;
  case 'дама':s.ves=-5;break;
 }
 if (s.n=='король пики')s.ves=8;
 if (s.n=='дама пики')s.ves=-8;
}
};




var zi=0;var sm=0;var pero={};pero.ix=0;pero.iy=0;pero.style=0;pero.style=0;md=false;var perop;
 stol=document.getElementsByClassName('veer');
 veerok=document.getElementsByClassName('stol');
 pole=document.getElementsByClassName('pole');
 win=document.getElementById('win');
 colod=document.getElementsByClassName('coloda');


	//win.append(mmm);
	for(c of colod){c.style.zIndex=-1}
 colod[0].style.top='10px';colod[0].style.left='475px';
 colod[1].style.top='10px';colod[1].style.left='355px';
 colod[2].style.top='10px';colod[2].style.left='235px';colod[2].style.height='150px';
 colod[3].style.top='10px';colod[3].style.left='120px';colod[3].style.height='150px';
 colod[4].style.top='10px';colod[4].style.left='5px';colod[4].style.height='150px';
stol[0].style.zIndex=0;stol[1].style.zIndex=1;stol[2].style.zIndex=2;
stol[0].py=+window.getComputedStyle(stol[0]).getPropertyValue('top').slice(0,-2);ty(stol[0],-220);
stol[1].py=+window.getComputedStyle(stol[1]).getPropertyValue('top').slice(0,-2);ty(stol[1],-260);
stol[2].py=+window.getComputedStyle(stol[2]).getPropertyValue('top').slice(0,-2);ty(stol[2],-280);
stol[0].rot=0;stol[1].rot=0;stol[2].rot=0;
stol[0].px=+window.getComputedStyle(stol[0]).getPropertyValue('left').slice(0,-2);tx(stol[0],170)
stol[1].px=+window.getComputedStyle(stol[1]).getPropertyValue('left').slice(0,-2);tx(stol[1],170);
stol[2].px=+window.getComputedStyle(stol[2]).getPropertyValue('left').slice(0,-2);tx(stol[2],170);
for (s of stol){s.addEventListener('mouseout',zatem,true);s.addEventListener('mouseover',osvet,true)};

function risk(krt,canva){
switch (krt.n) {
  case "шесть пики":ofX=rX*1;ofY=rY*2;risuem(img[1],canva);break;
  case "шесть черви":ofX=rX*2;ofY=rY*2;risuem(img[1],canva);break;
  case "шесть бубны":ofX=rX*0;ofY=rY*0;risuem(img[2],canva);break;
  case "шесть крести":ofX=rX*1;ofY=rY*0;risuem(img[2],canva);break;

  case "семь бубны":ofX=rX*2;ofY=rY*0;risuem(img[2],canva);break;
  case "семь крести":ofX=rX*0;ofY=rY*1;risuem(img[2],canva);break;
  case "семь черви":ofX=rX*1;ofY=rY*1;risuem(img[2],canva);break;
  case "семь пики":ofX=rX*2;ofY=rY*1;risuem(img[2],canva);break;

  case "восемь черви":ofX=rX*0;ofY=rY*2;risuem(img[2],canva);break;
  case "восемь пики":ofX=rX*1;ofY=rY*2;risuem(img[2],canva);break;
  case "восемь бубны":ofX=rX*2;ofY=rY*2+10;risuem(img[2],canva);break;
  case "восемь крести":ofX=rX*0;ofY=rY*0;risuem(img[3],canva);break;

  case "девять бубны":ofX=rX*1;ofY=rY*0;risuem(img[3],canva);break;
  case "девять крести":ofX=rX*2;ofY=rY*0;risuem(img[3],canva);break;
  case "девять черви":ofX=rX*0;ofY=rY*1;risuem(img[3],canva);break;
  case "девять пики":ofX=rX*1;ofY=rY*1;risuem(img[3],canva);break;

  case "десять бубны":ofX=rX*2;ofY=rY*1;risuem(img[3],canva);break;
  case "десять пики":ofX=rX*0;ofY=rY*2;risuem(img[3],canva);break;
  case "десять черви":ofX=rX*1-5;ofY=rY*2;risuem(img[3],canva);break;
  case "десять крести":ofX=rX*2;ofY=rY*2;risuem(img[3],canva);break

  case "валет пики":ofX=rX*0;ofY=rY*0;risuem(img[4],canva);break;
  case "валет бубны":ofX=rX*1-10;ofY=rY*0;risuem(img[4],canva);break;
  case "валет крести":ofX=rX*2-25;ofY=rY*0;risuem(img[4],canva);break;
  case "валет черви":ofX=rX*0;ofY=rY*1-20;risuem(img[4],canva);break

  case "дама крести":ofX=rX*1-25;ofY=rY*1-25;risuem(img[4],canva);break;
  case "дама черви":ofX=rX*2-25;ofY=rY*1-25;risuem(img[4],canva);break;
  case "дама пики":ofX=rX*0-5;ofY=rY*2-35;risuem(img[4],canva);break;
  case "дама бубны":ofX=rX*1-15;ofY=rY*2-35;risuem(img[4],canva);break

  case "король крести":ofX=rX*2-25;ofY=rY*2-35;risuem(img[4],canva);break;
  case "король черви":ofX=rX*0;ofY=rY*0;risuem(img[5],canva);break;
  case "король черви":ofX=rX*1;ofY=rY*0;risuem(img[5],canva);break;
  case "король пики":ofX=rX*2;ofY=rY*0;risuem(img[5],canva);break
  case "король бубны":ofX=rX*0;ofY=rY*1;risuem(img[5],canva);break;

  case "туз крести":ofX=rX*1;ofY=rY*1;risuem(img[5],canva);break;
  case "туз черви":ofX=rX*2;ofY=rY*1;risuem(img[5],canva);break;
  case "туз пики":ofX=rX*0;ofY=rY*2;risuem(img[5],canva);break
  case "туз бубны":ofX=rX*1;ofY=rY*2+10;risuem(img[5],canva);break

  };
};
function risuem (imaga,canva){
//if(canva==0){var shirina=220/2; var visota=300/2;}
//if(canva!=0){var shirina=50; var visota=100;}
ctxk.drawImage(imaga, ofX, ofY, rX, rY,0, 0,canvas.width,canvas.height);
var imk=new Image(110,200);imk.crossOrigin = "anonymous";
imk.src=canvas.toDataURL();ctxk.clearRect(0, 0, canvas.width, canvas.height);
canva.style.backgroundImage = 'url('+imk.src+')';
canva.style.backgroundSize='100%'
};

function dk(krt){
						if (zi<12)s=stol[0];if (zi>=12)s=stol[1];if (zi>=24)s=stol[2];
						s.appendChild(document.createElement('div')).className='pole';
						var p=pole[pole.length-1];
						risk(krt,p);
					  p.rot=0;

            p.px=+window.getComputedStyle(p).getPropertyValue('left').slice(0,-2);
						p.py=+window.getComputedStyle(p).getPropertyValue('top').slice(0,-2);
            p.style.zIndex=zi;p.zi=zi;zi++;



						//p.onmouseup = function() {p.onmouseup = null; };

						p.ondragstart = function() { return false};
    				//



            veer(p,s);

            }


function onMouseMove(event){perop.style.left=event.pageX-perop.ix+'px';
perop.style.top=event.pageY-perop.iy+'px';};


function veer(e,s){
	if (s==stol[0])ss=0;if (s==stol[1])ss=12;if (s==stol[2])ss=24;

	rot(e,(zi-ss)*10);
	tx(e,(zi-ss)*10);rot(s,-3.7);
	ty(s,-12);
	tx(s,-18);

	if(ss==12){ty(stol[0],3);ty(stol[1],0);}//ty(stol[0],3);rot(stol[0],-0.4);}
	if(ss==24){ty(stol[0],6);ty(stol[1],5);}
};




function rot (e,g){e.rot+=g; e.style.transform=`rotate(${e.rot}deg)`}

function ty(e,y){e.py-=y;e.style.top=e.py+'px';

}
function tx(e,x){e.px+=x;e.style.left=e.px+'px';

}


function osvet(e) {//e.path[0].style.backgroundColor='#FFC3C3';
p=e.path[0];
p.onmousedown = function(event) {
	//for(d of pole){if(d!=p)d.onmousedown=null}
	p.addEventListener('mousemove', onMouseMove);
	pero=p.parentNode.cloneNode(false);
	pero.addEventListener('mouseout',zatem,true);pero.addEventListener('mouseover',osvet,true);
	perop=p.parentNode.parentNode.cloneNode(false);
	document.body.append(perop);
	perop.append(pero);
	pero.append(p);
	p.zIndex=10000;

	for (s of stol){s.removeEventListener('mouseout',zatem,true);s.removeEventListener('mouseover',osvet,true)};
	pero.addEventListener('mouseout',zatem,true);pero.addEventListener('mouseover',osvet,true);
	perop.ix = event.pageX;
	perop.iy = event.pageY;
	perop.style.left=event.pageX-perop.ix+'px';
	perop.style.top=event.pageY-perop.iy+'px';
}

p.onmouseup = function() {
	//p.onmouseup = null;
	p.removeEventListener('mousemove', onMouseMove);
	for (s of stol){s.addEventListener('mouseout',zatem,true);s.addEventListener('mouseover',osvet,true)};

	if(p.style.zIndex<12){stol[0].append(p);return};
	if(p.style.zIndex<24){stol[1].append(p);return};
	stol[2].append(p);
}
}
function zatem(e){//e.path[0].style.backgroundColor='#FF7373';

e.path[0].removeEventListener('mousemove', onMouseMove);
for (s of stol){s.addEventListener('mouseout',zatem,true);s.addEventListener('mouseover',osvet,true)};
if (veerok[3])veerok[3].remove();
console.log(e);
if(e.path[0].style.zIndex<12){stol[0].append(e.path[0]);return};
if(e.path[0].style.zIndex<24){stol[1].append(e.path[0]);return};
stol[2].append(e.path[0]);

}



itc=0;
//interval=setInterval(()=>{dk();itc++;if(itc>=36)clearInterval(interval)},500);



//pole[0].style.width=`${pole[0].getBoundingClientRect().height/20}px`
//# sourceURL=userscript.js
</script>
</body>
</html>
